<!doctype html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>主页</title>
    <link rel="stylesheet" href="../lib/layui/css/layui.css">
    <link rel="stylesheet" href="../css/home.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/add.css">
    <link rel="stylesheet" href="../css/seepage.css">
    <link rel="stylesheet" href="../css/bootstrapStyle/bootstrapStyle.css" type="text/css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <style>
        .zzlist,.fllist,.searchfllist{position: relative;}
        #treeDemo,#treeDemo1{
            height: 400px;
            overflow-y: auto;
        }
        .zzlist #treeDemo,.fllist #treeDemo1,.searchfllist #treeDemo2{
            width: 230px;
            display: none;
            position: absolute;
            background: #fff;
            border: 1px solid #ddd;
            left: 0;
            top: 32px;
            z-index: 100;
        }
        .salesbox{
            padding: 15px;
        }
        .salesbox label{
            margin: 10px;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="logo">
            <img src="../images/logo.jpg" alt="">
      </div>
            <div class="banner">
                <img class="logo-icon" src="../images/logo-icon.jpg" alt="">
                <ul class="layui-nav layui-bg-cyan">
                    <li class="layui-nav-item">
                        <a href="javascript:;">供应商管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="">供应商维护</a></dd>
                            <dd><a href="">供应商审核</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="javascript:;">系统设置</a>
                        <dl class="layui-nav-child">
                            <dd><a href="">供应商类别</a></dd>
                            <dd><a href="">发布消息</a></dd>
                            <dd><a href="">发布招商公告12121313321321</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="javascript:;">个人中心</a>
                        <dl class="layui-nav-child">
                            <dd><a href="">基本信息</a></dd>
                            <dd><a href="">密码修改</a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
            <div>
                <div class="com-crumb">
                    <i class="layui-icon">&#xe68e;</i>
                    <span class="com-crumb-span">
                <a href="/">首页</a><span class="fg">/</span><a><cite>导航元素</cite></a>
                    </span>
                </div>
            </div>
        </div>
        <div class="wrapper">
            <div class="btn">
                <button class="layui-btn" onclick="openadd()">新增</button>
                <button class="layui-btn" onclick="searchbox()">查询</button>
                <button class="layui-btn" onclick="location.href='seepage.html'">管理员查询</button>
                <button class="layui-btn" id="delet">删除</button>
            </div>
            <div class="record_data">
                <table border="0" cellpadding="0" cellspacing="0" align="left" width="100%">
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>名称</th>
                            <th>分类</th>
                            <th>资质</th>
                            <th>销售类别</th>
                            <th>主营业务</th>
                        </tr>
                    </thead>
                    <tbody id="tabledata"></tbody>
                </table>
            </div>
            <div id="nodata" style="text-align: center;margin-top: 20px;"></div>
            <div id="pages"></div>
        </div>
        <script src="../lib/layui/layui.all.js"></script>
        <script type="text/javascript" src="../js/jquery.ztree.core.js"></script>
        <script type="text/javascript" src="../js/jquery.ztree.excheck.js"></script>
        <script type="text/javascript" src="../js/jquery.ztree.exedit.js"></script>
        <script>
            $('#delet').click(function(){
                $("#tabledata tr").remove()
            })

        function sendJsonData(data,url,method,fun){

            $.ajax({
                url:url,
                data:data,
                dataType:"json",
                contentType:"application/json",
                method:method,
                success:fun
            });

        }

        var zNodes = [


        ];
        var allhtml = $('#tabledata');
        layui.use('laypage', function() {
            var laypage = layui.laypage;
            //执行一个laypage实例
            var i = 0;
            $.ajax({
                url:"/customerCount",
                contentType:"application/json",
                dataType:"json",
                data:JSON.stringify({}),
                method:"post",
                async:false,
                success:function(data){

                    i = data.data[0];
                }
            });
            laypage.render({
                limit: 20, // 每页条数
                elem: 'pages', //注意，这里的 test1 是 ID，不用加 # 号,
                count:i, //数据总数，从服务端得到
                jump: function(obj, first){
                    //obj包含了当前分页的所有参数，比如：
                    console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                    console.log(obj.limit); //得到每页显示的条数
                    sendJsonData(JSON.stringify({"size":obj.limit,"pageNum":obj.curr}),"/customerPages","post",function(data){
                        localStorage.removeItem("datalist");
                        localStorage.setItem('datalist', JSON.stringify(data.data));
                        getdatas();
                    });

                    // alert(obj.curr);
                    //首次不执行
                    if(!first){
                        //do something
                    }
                }
            });
        });


        // 保存提交添加供应商信息
        function getmsg(type) {
            var msg = localStorage.getItem('datalist');
            var data = {
                version:$("#version").val(),//记录版本信息
                id: $('#id').val(),//客商id
                name: $('#name').val(), // 供方名称
				money: $('#money').val(), // 注册资金
                legal: $('#legal').val(), // 法人
                nature: $('#nature').val(), //企业性质
                address: $('#address').val(), //办公地址
                province: $('#province').val(), //区域-省份
                city: $('#city').val(), //区域-城市
                url: $('#url').val(), //官方网站
                nstype: $('#nstype').val(), //纳税人类型
                type: $('#type').val(), // 供方分类
                zyzdate: $('#zyzdate').val(), // 营业执照起始日期
                zzh: $('#zzh').val(), // 营业执照号
                diode: $('#diode').val(), //主营资质                
                yyzz: $('#yyzz').val(), // 兼营业务资质
                sales: $('#sales').val(), // 体系认证                
                brand: $('#brand').val(), // 产品许可证
                range: $('#range').val(), // 主营业务范围

                general: $('#general').val(), // 总部
                branch: $('#branch').val(), // 分支机构                

                business: $('#business').val(), //主营业务区域
                equipment: $('#equipment').val(), //加工生产设备
                apc: $('#apc').val(), //年产能力
                after: $('#after').val(), //售后服务能力
                wxie: $('#wxie').val(), //外协厂家
                ywyj: $('#ywyj').val(), //以往业绩

                linkman: $('#linkman').val(), // 联系人
                phone: $('#phone').val(), // 联系固话
                tel: $('#tel').val(), // 手机
                email: $('#email').val() // 邮箱
            };
            for (var i in data) {
                if(i!='version'&&i!='id'){
                    if (data[i].trim().length == 0) {
                        layer.msg('请添加完所有的信息');
                        return
                    }
                }
            }
            if (type != undefined) {
                sendJsonData(JSON.stringify(data),"/updateCustomer","post",function(d){

                    if(d.code==200){
                        msg = JSON.parse(msg);
                        msg[type] = d.data[0];
                        localStorage.setItem('datalist', JSON.stringify(msg));
                        layer.msg('修改成功');
                        getdatas();
                        layer.closeAll(); // 关闭layui的弹窗
                    }else{
                        layer.msg(d.msg);
                    }

                });
                // msg = JSON.parse(msg);
                // msg[type] = data;
                // localStorage.setItem('datalist', JSON.stringify(msg));
                // layer.msg('修改成功');
                // layer.closeAll(); // 关闭layui的弹窗
            } else {
                if (msg == null) {
                    sendJsonData(JSON.stringify(data),"/saveCustomer","post",function(d){

                        if(d.code==200){
                            var datalist = [];
                            datalist.push(data);
                            localStorage.setItem('datalist', JSON.stringify(datalist));
                            layer.msg('添加成功');
                            getdatas();
                            layer.closeAll(); // 关闭layui的弹窗
                        }else{
                            layer.msg(d.msg);
                        }

                    });

                } else {
                    sendJsonData(JSON.stringify(data),"/saveCustomer","post",function(d){

                        if(d.code==200){
                            msg = JSON.parse(msg);
                            msg.unshift(data);
                            localStorage.setItem('datalist', JSON.stringify(msg));
                            layer.msg('添加成功');
                            getdatas();
                            layer.closeAll(); // 关闭layui的弹窗
                        }else{
                            layer.msg(d.msg);
                        }

                    });
                    // msg = JSON.parse(msg);
                    // msg.unshift(data);
                    // localStorage.setItem('datalist', JSON.stringify(msg));
                    // layer.msg('添加成功');
                    // layer.closeAll(); // 关闭layui的弹窗
                }
            }
            getdatas();
            // layer.closeAll(); // 关闭layui的弹窗
        }
        getdatas();
        // 在本地获取所有的商家信息
        function getdatas() {
            var data = JSON.parse(localStorage.getItem('datalist'));
            if (data == null || data.length == 0) {
                $('#nodata').html('没有数据');
                data = []
            }else{
                $('#nodata').html('');
            }
            var html = '';
            data.map(function(item, idx) {
                html += '<tr>' +
                    '<td>' + parseInt(idx + 1) + '</td>' +
                    '<td onclick="chousedata(event,' + idx + ')" style="cursor:pointer;">' + item.name + '</td>' +
                    '<td>' + item.type + '</td>' +
                    '<td>' + item.diode + '</td>' +
                    '<td>' + item.sales + '</td>' +
                    '<td>' + item.business + '</td>' +
                    '</tr>'
            });
            $('#tabledata').html(html);
        }
        //        查询。修改
        function chousedata(event, idx) {
            event.stopPropagation(); // 阻止时间冒泡
            let addhtml = '<div style="padding-top: 20px;"><form class="layui-form"> <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素 -->' +
                '<h4>（一）供方基本信息</h4>' +
                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>供方名称</p>' +
                '       <div><input type="text" name="" class="layui-input" id="name"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>注册资金</p>' +
                '       <div><input type="number" name="" class="layui-input" id="money"></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>法人代表</p>' +
                '       <div><input type="text" name="" class="layui-input" id="legal"></div>' +
                '    </div>' +
                '    <div class="fr">' +
                '       <p>企业性质</p>' +
                '       <div><select name="interest" id="nature"  style="display:block;width:100%">' +
                '           <option value="0">外资</option>' +
                '           <option value="1" selected="">合资</option>' +
                '           <option value="2">国企</option>' +
                '           <option value="3">私企</option>' +
                '           <option value="4">集体所有制</option>' +
                '           <option value="5">其他</option>' +
                '       </select></div>' +
                '    </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>办公地址</p>' +
                '       <div><input type="text" name="" class="layui-input" id="address"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>地域</p>' +
                '       <div><select name="interest" id="province"  style="display:inline-block;width:48%">' +
                '           <option value="0" selected="">广东省</option>' +
                '           <option value="1" >江苏省</option>' +
                '           <option value="2">浙江省</option>' +
                '           <option value="3">山东省</option>' +
                '       </select><select name="interest" id="city"  style="display:inline-block;width:48%;margin-left:2%">' +
                '           <option value="0">深圳市</option>' +
                '           <option value="1" selected="">广州市</option>' +
                '           <option value="2">东莞市</option>' +
                '           <option value="3">佛山市</option>' +
                '       </select></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>官方网站</p>' +
                '       <div><input type="text" name="" class="layui-input" id="url"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>纳税人类型</p>' +
                '       <div><input type="text" name="" class="layui-input" id="nstype"></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>供方分类</p>' +
                '       <div class="fllist"><ul id="treeDemo1" style="width:230px;" class="ztree"></ul><input type="text" name="" class="layui-input" readonly id="type"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>营业执照起始日期</p>' +
                '       <div> <input type="text" name="date" id="zyzdate" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input"></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>营业执照号</p>' +
                '       <div><input type="text" name="" class="layui-input" id="zzh"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>主营资质</p>' +
                '       <div class="zzlist"><ul id="treeDemo" style="width:230px;" class="ztree"></ul><input type="text" name="" class="layui-input" id="diode" readonly></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>兼营业务资质</p>' +
                '                <div><input type="text" name="" class="layui-input" id="yyzz"></div>' +
                '            </div>' +
                '            <div class="fr">' +
                '                <p>体系认证</p>' +
                '                <div><input type="text" name="" class="layui-input" id="sales"></div>' +
                '            </div>' +
                '        </div>' +

                '        <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>产品许可证</p>' +
                '                <div><input type="text" name="" class="layui-input" id="brand"></div>' +
                '            </div>' +
                '            <div class="fr">' +
                '                <p>主营业务范围</p>' +
                '                <div><input type="text" name="" class="layui-input" id="range"></div>' +
                '            </div>' +
                '        </div>' +

                '<br>' +
                '<h4>（二）供方机构信息</h4>' +
                ' <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>总部</p>' +
                '                <div><input type="text" name="" class="layui-input" id="general"></div>' +
                '            </div>' +
                '            <div class="fr">' +
                '                <p>分支机构</p>' +
                '                <div><input type="text" name="" class="layui-input" id="branch"></div>' +
                '   </div>' +
                '</div>' +
                '<br>' +
                '<h4>（三）供方业务状况</h4>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>主营业务区域</p>' +
                '                <div><input type="text" name="" class="layui-input" id="business"></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>加工生产设备</p>' +
                '                <div><input type="text" name="" class="layui-input" id="equipment"></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>年产能力</p>' +
                '                <div><input type="text" name="" class="layui-input" id="apc"></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>售后服务能力</p>' +
                '                <div><input type="text" name="" class="layui-input" id="after"></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>外协厂家</p>' +
                '                <div><input type="text" name="" class="layui-input" id="wxie"></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>以往业绩（项目名称、开发商、合同内容、规模、状态）</p>' +
                '                <div><input type="text" name="" class="layui-input" id="ywyj"></div>' +
                '            </div>' +
                '</div>' +

                '<br>' +
                '<h4>（四）供方联系方式</h4>' +


                '        <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>联系人</p>' +
                '                <div><input type="text" name="" class="layui-input" id="linkman"></div>' +
                '            </div>' +
                '            <div class="fr center">' +
                '                <p>联系固话</p>' +
                '                <div><input type="text" name="" class="layui-input" id="phone"></div>' +
                '            </div>' +

                '        </div>' +

                '        <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>手机</p>' +
                '                <div><input type="text" name="" class="layui-input" id="tel"></div>' +
                '            </div>' +
                '            <div class="fr">' +
                '                <p>邮箱</p>' +
                '                <div><input type="text" name="" class="layui-input" id="email"></div>' +
                '            </div>' +
                '        </div>' +
                '        <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>附件清单</p>' +
                '                <div><button type="button" class="layui-btn" id="upfile1"><i class="layui-icon">&#xe67c;</i>上传文件</button></div>' +
                '            </div>' +

                '        </div>' +
                '        <div class="textcenter">' +
                '            <button id="startupfile" class="layui-btn" type="button" onclick="getmsg(' + idx + ')">保存</button>' +
                '            <button class="layui-btn canclemodel" type="button" onclick="cancleall()">取消</button>' +
                '        </div>' +
                '       <input type="hidden" id="id"/>' +
                '       <input type="hidden" id="version"/>' +
                '    </form></div>';
            $('.canclemodel').click(function() {
                layer.closeAll()
            });


            var datalist = JSON.parse(localStorage.getItem('datalist'));
            var nowdata = datalist[idx];
            layer.open({
                type: 1,
                title: '查看并修改供应商信息',
                offset: 't',
                maxmin: true,
                //                offset: '100px',
                area: ['85%', '100%'],
                content: addhtml, // iframe的url
                success: function() {
                    // $.fn.zTree.init($("#treeDemo"), setting, zyzz);
                    // $.fn.zTree.init($("#treeDemo1"), settingtype, zNodes);
                    $("#version").val(nowdata.version);
                    $('#id').val(nowdata.id); // 供方名称
                    $('#name').val(nowdata.name); // 供方名称
                    $('#money').val(nowdata.money); // 注册资金
                    $('#legal').val(nowdata.legal), // 法人
                        $('#nature').val(nowdata.nature); //企业性质
                    $('#address').val(nowdata.address); //办公地址
                    $('#province').val(nowdata.province); //区域-省份
                    $('#city').val(nowdata.city); //区域-城市
                    $('#url').val(nowdata.url); //官方网站
                    $('#nstype').val(nowdata.nstype); //纳税人类型
                    $('#type').val(nowdata.type); // 供方分类
                    $('#zyzdate').val(nowdata.zyzdate); // 营业执照起始日期
                    $('#zzh').val(nowdata.zzh); // 营业执照号
                    $('#diode').val(nowdata.diode); //主营资质
                    $('#yyzz').val(nowdata.yyzz); // 兼营业务资质
                    $('#sales').val(nowdata.sales); // 体系认证 
                    $('#brand').val(nowdata.brand); // 产品许可证
                    $('#range').val(nowdata.range); // 主营业务范围
                    $('#general').val(nowdata.general); // 总部
                    $('#branch').val(nowdata.branch); // 分支机构 
                    $('#business').val(nowdata.business); //主营业务区域
                    $('#equipment').val(nowdata.equipment); //加工生产设备
                    $('#apc').val(nowdata.apc); //年产能力
                    $('#after').val(nowdata.after); //售后服务能力
                    $('#wxie').val(nowdata.wxie); //外协厂家
                    $('#ywyj').val(nowdata.ywyj); //以往业绩

                    $('#linkman').val(nowdata.linkman); // 联系人
                    $('#phone').val(nowdata.phone); // 联系固话
                    $('#tel').val(nowdata.tel); // 手机
                    $('#email').val(nowdata.email); // 邮箱

                    init();

                    //文件上传
                    layui.use('upload', function() {
                        var $ = layui.jquery
                            , upload = layui.upload;

                        //选完文件后不自动上传
                        upload.render({
                            elem: '#upfile1'
                            ,url: '/uploadHome'
                            ,data:{
                                "path":"test/test1"
                            }
                            ,auto: false
                            ,multiple: true,
                            accept: 'file'
                            ,bindAction: '#startupfile'
                            ,done: function(res){
                                // alert(res);
                                console.log(res)
                            }
                        });

                    });
                }
            });



        }


        //树形
        var setting = {
            view: {
                removeHoverDom: removeHoverDom,
                selectedMulti: false,
                addDiyDom: addDiyDom
            },

            callback: {
                beforeClick: zTreeBeforeClick
            },
            data: {
                simpleData: {
                    enable: true
                }
            },

        };
        var settingtype = {
            view: {
                removeHoverDom: removeHoverDom,
                selectedMulti: false,
                addDiyDom: addDiyDom
            },

            callback: {
                beforeClick: typezTreeBeforeClick
            },
            data: {
                simpleData: {
                    enable: true
                }
            },

        };
        var searchsetting = {
            view: {
                removeHoverDom: removeHoverDom,
                selectedMulti: false,
                addDiyDom: addDiyDom
            },

            callback: {
                beforeClick: searchtypezTreeBeforeClick
            },
            data: {
                simpleData: {
                    enable: true
                }
            },

        };

        function addDiyDom(treeId, treeNode) {
            var spaceWidth = 5;
            var switchObj = $("#" + treeNode.tId + "_switch"),
                icoObj = $("#" + treeNode.tId + "_ico");
            switchObj.remove();
            icoObj.before(switchObj);

            if (treeNode.level > 1) {
                var spaceStr = "<span style='display: inline-block;width:" + (spaceWidth * treeNode.level) + "px'></span>";
                switchObj.before(spaceStr);
            }
            var spantxt = $("#" + treeNode.tId + "_span").html();
            if (spantxt.length > 9) {
                spantxt = spantxt.substring(0, 9) + "...";
                $("#" + treeNode.tId + "_span").html(spantxt);
            }
        }

        function getFilePath(treeObj) {
            if (treeObj == null) return "";
            var filename = treeObj.name;
            var pNode = treeObj.getParentNode();
            if (pNode != null) {
                filename = getFilePath(pNode) + ">" + filename;
            }
            return filename;
        }

        function zTreeBeforeClick(treeId, treeNode, clickFlag) {
            console.log(treeNode);

            $('#diode').val(getFilePath(treeNode));
            $('#treeDemo').hide()
        };

        function typezTreeBeforeClick(treeId, treeNode, clickFlag) {
            console.log(treeNode);

            $('#type').val(getFilePath(treeNode));
            $('#treeDemo1').hide()
        };

        function searchtypezTreeBeforeClick(treeId, treeNode, clickFlag) {
            console.log(treeNode);
            $('#searchtit').html(getFilePath(treeNode));
            $('#searchfl').val(treeNode.name);
            $('#treeDemo2').hide()
        };



        var zyzz = [
            { id: 1, pId: 0, name: '施工承包' },
            { id: 2, pId: 1, name: '建筑工程施工总承包' },
            { id: 3, pId: 2, name: ' 特级' },
            { id: 4, pId: 2, name: '一级' },
            { id: 5, pId: 2, name: '二级' },
            { id: 6, pId: 2, name: '三级' },
            { id: 7, pId: 1, name: '机电施工总承包' },
            { id: 8, pId: 7, name: ' 特级' },
            { id: 9, pId: 7, name: '一级' },
            { id: 10, pId: 7, name: '二级' },
            { id: 11, pId: 7, name: '三级' },
            { id: 12, pId: 1, name: '市政公用工程施工总承包' },
            { id: 13, pId: 12, name: ' 特级' },
            { id: 14, pId: 12, name: '一级' },
            { id: 15, pId: 12, name: '二级' },
            { id: 16, pId: 12, name: '三级' },
            { id: 17, pId: 1, name: '电力工程施工总承包' },
            { id: 18, pId: 17, name: ' 特级' },
            { id: 19, pId: 17, name: '一级' },
            { id: 20, pId: 17, name: '二级' },
            { id: 21, pId: 17, name: '三级' },
            { id: 22, pId: 1, name: '通信工程施工总承包' },
            { id: 23, pId: 22, name: ' 特级' },
            { id: 24, pId: 22, name: '一级' },
            { id: 25, pId: 22, name: '二级' },
            { id: 26, pId: 22, name: '三级' },
            { id: 27, pId: 1, name: '其他' },
            { id: 28, pId: 27, name: ' 特级' },
            { id: 29, pId: 27, name: '一级' },
            { id: 30, pId: 27, name: '二级' },
            { id: 31, pId: 27, name: '三级' },


            { id: 32, pId: 0, name: '专业分包' },

            { id: 33, pId: 32, name: '消防设施工程专业承包' },
            { id: 34, pId: 33, name: '一级' },
            { id: 35, pId: 33, name: '二级' },
            { id: 36, pId: 33, name: '三级' },

            { id: 37, pId: 32, name: '地基基础工程专业承包' },
            { id: 38, pId: 37, name: '一级' },
            { id: 39, pId: 37, name: '二级' },
            { id: 40, pId: 37, name: '三级' },

            { id: 41, pId: 32, name: '建筑机电安装专业承包' },
            { id: 42, pId: 41, name: '一级' },
            { id: 43, pId: 41, name: '二级' },
            { id: 44, pId: 41, name: '三级' },
            { id: 45, pId: 32, name: '电子与智能化工程专业承包' },
            { id: 46, pId: 45, name: '一级' },
            { id: 47, pId: 45, name: '二级' },
            { id: 48, pId: 45, name: '三级' },

            { id: 49, pId: 32, name: '电力专业承包' },
            { id: 50, pId: 49, name: '一级' },
            { id: 51, pId: 49, name: '二级' },
            { id: 52, pId: 49, name: '三级' },

            { id: 53, pId: 32, name: '市政公用工程专业承包' },
            { id: 54, pId: 53, name: '一级' },
            { id: 55, pId: 53, name: '二级' },
            { id: 56, pId: 53, name: '三级' },
            { id: 57, pId: 32, name: ' 园林景观施工' },
            { id: 58, pId: 57, name: '一级' },
            { id: 59, pId: 57, name: '二级' },
            { id: 60, pId: 57, name: '三级' },
            { id: 61, pId: 32, name: '建筑幕墙专业承包' },
            { id: 62, pId: 61, name: '一级' },
            { id: 63, pId: 61, name: '二级' },
            { id: 64, pId: 61, name: '三级' },
            { id: 65, pId: 32, name: '建筑装修装饰工程专业承包' },
            { id: 66, pId: 65, name: '一级' },
            { id: 67, pId: 65, name: '二级' },
            { id: 68, pId: 65, name: '三级' },

            { id: 69, pId: 32, name: '防水防腐保温工程专业承包' },
            { id: 70, pId: 69, name: '一级' },
            { id: 71, pId: 69, name: '二级' },
            { id: 72, pId: 69, name: '三级' },

            { id: 73, pId: 32, name: '城市及道路照明专业承包' },
            { id: 74, pId: 73, name: '一级' },
            { id: 75, pId: 73, name: '二级' },
            { id: 76, pId: 73, name: '三级' },
            { id: 77, pId: 32, name: ' 钢结构工程专业承包' },
            { id: 78, pId: 77, name: '一级' },
            { id: 79, pId: 77, name: '二级' },
            { id: 80, pId: 77, name: '三级' },
            { id: 81, pId: 32, name: ' 古建筑工程专业承包' },
            { id: 82, pId: 81, name: '一级' },
            { id: 83, pId: 81, name: '二级' },
            { id: 84, pId: 81, name: '三级' },
            { id: 85, pId: 32, name: '输变电工程专业承包' },
            { id: 86, pId: 85, name: '一级' },
            { id: 87, pId: 85, name: '二级' },
            { id: 88, pId: 85, name: '三级' },
            { id: 89, pId: 32, name: '特种工程专业承包' },
            { id: 90, pId: 89, name: '一级' },
            { id: 91, pId: 89, name: '二级' },
            { id: 92, pId: 89, name: '三级' },
            { id: 93, pId: 32, name: '特种设备安装改造维修（锅炉）' },
            { id: 94, pId: 93, name: 'A' },
            { id: 95, pId: 93, name: 'B' },
            { id: 96, pId: 93, name: 'C' },
            { id: 97, pId: 32, name: '特种设备安装改造维修（电梯）：' },
            { id: 98, pId: 97, name: 'A' },
            { id: 99, pId: 97, name: 'B' },
            { id: 100, pId: 97, name: 'C' },
            { id: 101, pId: 32, name: '其他' },
            { id: 102, pId: 101, name: '一级' },
            { id: 103, pId: 101, name: '二级' },
            { id: 104, pId: 101, name: '三级' },


            { id: 105, pId: 0, name: '设计类' },
            { id: 106, pId: 105, name: '建筑装饰工程设计专项' },
            { id: 107, pId: 106, name: '甲级' },
            { id: 108, pId: 106, name: '乙级' },
            { id: 109, pId: 106, name: '丙级' },
            { id: 110, pId: 105, name: '建筑智能化系统设计专项' },
            { id: 111, pId: 110, name: '甲级' },
            { id: 112, pId: 110, name: '乙级' },
            { id: 113, pId: 105, name: '建筑工程' },
            { id: 114, pId: 113, name: '甲级' },
            { id: 115, pId: 113, name: '乙级' },
            { id: 116, pId: 105, name: '建筑幕墙工程设计专项' },
            { id: 117, pId: 116, name: '甲级' },
            { id: 118, pId: 116, name: '乙级' },
            { id: 119, pId: 105, name: '轻型房屋钢结构设计专项' },
            { id: 120, pId: 119, name: '甲级' },
            { id: 121, pId: 119, name: '乙级' },

            { id: 122, pId: 105, name: '风景园林工程设计专项' },
            { id: 123, pId: 122, name: '甲级' },
            { id: 124, pId: 122, name: '乙级' },

            { id: 125, pId: 105, name: '城市规划' },
            { id: 126, pId: 125, name: '甲级' },
            { id: 127, pId: 125, name: '乙级' },
            { id: 128, pId: 105, name: '消防设施工程设计专项' },
            { id: 129, pId: 128, name: '甲级' },
            { id: 130, pId: 128, name: '乙级' },
            { id: 131, pId: 105, name: '环境工程设计专项' },
            { id: 132, pId: 131, name: '甲级' },
            { id: 133, pId: 131, name: '乙级' },
            { id: 134, pId: 105, name: '照明工程设计专项' },
            { id: 135, pId: 134, name: '甲级' },
            { id: 136, pId: 134, name: '乙级' },
            { id: 137, pId: 105, name: '岩土工程勘察' },
            { id: 138, pId: 137, name: '甲级' },
            { id: 139, pId: 137, name: '乙级' },
            { id: 140, pId: 137, name: '丙级' },
            { id: 141, pId: 105, name: '施工图审查' },
            { id: 142, pId: 141, name: '一类' },
            { id: 143, pId: 141, name: '二类' },
            { id: 144, pId: 105, name: '工程勘察综合资质' },
            { id: 145, pId: 144, name: '甲级' },
            { id: 146, pId: 105, name: '测绘' },
            { id: 147, pId: 146, name: '甲级' },
            { id: 148, pId: 146, name: '乙级' },
            { id: 149, pId: 146, name: '丙级' },
            { id: 150, pId: 105, name: '其他' },
            { id: 151, pId: 150, name: '甲级' },
            { id: 152, pId: 150, name: '乙级' },
            { id: 153, pId: 150, name: '丙级' },

            { id: 154, pId: 0, name: '咨询服务' },
            { id: 155, pId: 154, name: '招标代理' },
            { id: 156, pId: 155, name: '甲级' },
            { id: 157, pId: 155, name: '乙级' },
            { id: 158, pId: 154, name: '造价咨询' },
            { id: 159, pId: 158, name: '甲级' },
            { id: 160, pId: 158, name: '乙级' },
            { id: 161, pId: 154, name: '工程监理' },
            { id: 162, pId: 161, name: '甲级' },
            { id: 163, pId: 162, name: '乙级' },
            { id: 164, pId: 162, name: '丙级' },
            { id: 165, pId: 154, name: '其他' },
            { id: 166, pId: 165, name: '甲级' },
            { id: 167, pId: 165, name: '乙级' },
            { id: 168, pId: 154, name: '交通规划' },
            { id: 169, pId: 168, name: '甲级' },
            { id: 170, pId: 168, name: '乙级' },
            { id: 171, pId: 154, name: '节能评估' },
            { id: 172, pId: 171, name: '甲级' },
            { id: 173, pId: 171, name: '乙级' },
            { id: 174, pId: 154, name: '环境影响评价' },
            { id: 175, pId: 174, name: '甲级' },
            { id: 176, pId: 174, name: '乙级' },
            { id: 177, pId: 154, name: '其他' },

        ]



        var newCount = 1;

        function addHoverDom(treeId, treeNode) {
            var sObj = $("#" + treeNode.tId + "_span");
            if (treeNode.editNameFlag || $("#addBtn_" + treeNode.tId).length > 0) return;
            var addStr = "<span class='button add' id='addBtn_" + treeNode.tId +
                "' title='add node' onfocus='this.blur();'></span>";
            sObj.after(addStr);
            var btn = $("#addBtn_" + treeNode.tId);
            if (btn) btn.bind("click", function() {
                var zTree = $.fn.zTree.getZTreeObj("treeDemo");
                zTree.addNodes(treeNode, { id: (100 + newCount), pId: treeNode.id, name: "new node" + (newCount++) });
                return false;
            });
        };

        function removeHoverDom(treeId, treeNode) {
            $("#addBtn_" + treeNode.tId).unbind().remove();
        };
        // $(document).on('click',function(e){
        //    if(e.target.id != 'diode' && e.target.id != 'treeDemo'){
        //        $('#treeDemo').hide();
        //    }  
        // })
        $(document).click(function(e) {
            if (e.target.id != 'diode' && e.target.id != 'treeDemo') {
                $('#treeDemo').hide();
            }
        });
        $(document).click(function(e) {
            if (e.target.id != 'type' && e.target.id != 'treeDemo1') {
                $('#treeDemo1').hide();
            }
        });
        $(document).click(function(e) {
            if (e.target.id != 'searchfl' && e.target.id != 'treeDemo2') {
                $('#treeDemo2').hide();
            }
        });
        $(document).on('click', '#treeDemo li', function(e) {
            e ? e.stopPropagation() : event.cancelBubble = true;
        })
        $(document).on('click', '#treeDemo1 li', function(e) {
            e ? e.stopPropagation() : event.cancelBubble = true;
        })
        $(document).on('click', '#treeDemo2 li', function(e) {
            e ? e.stopPropagation() : event.cancelBubble = true;
        })

        $(document).on('focus', '#diode', function(event) {
            console.log('djdd')
            $('#treeDemo').show()

        });
        $(document).on('focus', '#type', function(event) {
            console.log('djdd')
            $('#treeDemo1').show()

        });
        $(document).on('click', '#searchfl', function() {
            $('#treeDemo2').show();
        })




        var saleslist = ['9001', '14000', '28000', '其他'];

        var salesbox = '';

        function salesfn(type, data) {
            var html = '<div class="salesbox">';
            if (type == 'add') {
                for (var i = 0; i < saleslist.length; i++) {
                    html += '<label for="' + saleslist[i] + '"><input type="checkbox" id="' + saleslist[i] + '" value="' + saleslist[i] + '"/>' + saleslist[i] + '</label>'

                }
                html += '<div class="salesbtn">' +
                    '<div class="textcenter">' +
                    '<button class="layui-btn" type="button" onclick="addsales()">保存</button>' +
                    '</div></div></div>';
                return html;
            }
            if (type == 'edit') {

                console.log('获取')
                console.log(data)
                for (var i = 0; i < saleslist.length; i++) {
                    var has = false;
                    for (var j = 0; j < data.length; j++) {
                        if (saleslist[i] == data[j]) {
                            html += '<label for="' + saleslist[i] + '"><input type="checkbox" checked id="' + saleslist[i] + '" value="' + saleslist[i] + '"/>' + saleslist[i] + '</label>';
                            has = true;
                            break;
                        }


                    }
                    if (!has) {

                        html += '<label for="' + saleslist[i] + '"><input type="checkbox"  id="' + saleslist[i] + '" value="' + saleslist[i] + '"/>' + saleslist[i] + '</label>'

                    }




                }
                html += '<div class="salesbtn">' +
                    '<div class="textcenter">' +
                    '<button class="layui-btn" type="button" onclick="addsales()">保存</button>' +
                    '</div></div></div>';
                return html;
            }

        }

        $(document).on('click', '#sales', function() {
            var type = '';
            if ($(this).val() == '') {
                var getval = [];
            } else {
                var getval = $(this).val().split(',');
            }

            console.log(getval.length)
            if (getval.length > 0) {
                type = 'edit';
                var html = '<div class="salesbox"><label for="9001"><input type="checkbox" checked id="9001" value="9001"/>9001</label>' +
                    '<label for="14000"><input type="checkbox" checked id="14000" value="14000"/>14000</label>' +
                    '<label for="28000"><input type="checkbox" checked id="28000" value="28000"/>28000</label>' +
                    '<div class="salesbtn">' +
                    '<div class="textcenter">' +
                    '<button class="layui-btn" type="button" onclick="addsales()">保存</button>' +
                    '</div>' +
                    '</div>' +
                    '</div>';
            } else {
                type = 'add'
            }

            salesbox = layer.open({
                type: 1,
                title: ['添加体系认证', 'font-size:16px;'],
                area: ['300px', '300px'],
                fixed: false, //不固定
                offset: 't',
                maxmin: true,
                content: salesfn(type, getval),
                success: function(layero, index) {

                }
            });
        })

        function addsales() {
            var val = '';
            if ($('.salesbox input:checkbox:checked').length < 1) {
                alert('请选择一项');
                return;
            }
            $.each($('.salesbox input:checkbox:checked'), function(index) {
                val += $(this).val();
                if (index == $('.salesbox input:checkbox:checked').length - 1) {

                } else {
                    val += ','
                }
            })
            $('#sales').val(val);
            layer.close(salesbox);

        }
        // 打开添加供应商信息
        function openadd() {
            let addhtml = '<div style="padding-top: 20px;"><form class="layui-form"> <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素 -->' +
                '<h4>（一）供方基本信息</h4>' +
                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>供方名称</p>' +
                '       <div><input type="text" name="" class="layui-input" id="name"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>注册资金</p>' +
                '       <div><input type="number" name="" class="layui-input" id="money"></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>法人代表</p>' +
                '       <div><input type="text" name="" class="layui-input" id="legal"></div>' +
                '    </div>' +
                '    <div class="fr">' +
                '       <p>企业性质</p>' +
                '       <div><select name="interest" id="nature"  style="display:block;width:100%">' +
                '           <option value="0">外资</option>' +
                '           <option value="1" selected="">合资</option>' +
                '           <option value="2">国企</option>' +
                '           <option value="3">私企</option>' +
                '           <option value="4">集体所有制</option>' +
                '           <option value="5">其他</option>' +
                '       </select></div>' +
                '    </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>办公地址</p>' +
                '       <div><input type="text" name="" class="layui-input" id="address"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>地域</p>' +
                '       <div><select name="interest" id="province"  style="display:inline-block;width:48%">' +
                '           <option value="0" selected="">广东省</option>' +
                '           <option value="1" >江苏省</option>' +
                '           <option value="2">浙江省</option>' +
                '           <option value="3">山东省</option>' +
                '       </select><select name="interest" id="city"  style="display:inline-block;width:48%;margin-left:2%">' +
                '           <option value="0">深圳市</option>' +
                '           <option value="1" selected="">广州市</option>' +
                '           <option value="2">东莞市</option>' +
                '           <option value="3">佛山市</option>' +
                '       </select></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>官方网站</p>' +
                '       <div><input type="text" name="" class="layui-input" id="url"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>纳税人类型</p>' +
                '       <div><input type="text" name="" class="layui-input" id="nstype"></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>供方分类</p>' +
                '       <div class="fllist"><ul id="treeDemo1" style="width:230px;" class="ztree"></ul><input type="text" name="" readonly class="layui-input" id="type"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>营业执照起始日期</p>' +
                '       <div> <input type="text" name="date" id="zyzdate" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input"></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '   <div class="fl">' +
                '       <p>营业执照号</p>' +
                '       <div><input type="text" name="" class="layui-input" id="zzh"></div>' +
                '   </div>' +
                '   <div class="fr">' +
                '       <p>主营资质</p>' +
                '       <div class="zzlist"><ul id="treeDemo" style="width:230px;" class="ztree"></ul><input type="text" name="" class="layui-input" id="diode" readonly></div>' +
                '   </div>' +
                '</div>' +

                '<div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>兼营业务资质</p>' +
                '                <div><input type="text" name="" class="layui-input" id="yyzz"></div>' +
                '            </div>' +
                '            <div class="fr">' +
                '                <p>体系认证</p>' +
                '                <div><input type="text" name="" readonly class="layui-input" id="sales"></div>' +
                '            </div>' +
                '        </div>' +

                '        <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>产品许可证</p>' +
                '                <div><input type="text" name="" class="layui-input" id="brand"></div>' +
                '            </div>' +
                '            <div class="fr">' +
                '                <p>主营业务范围</p>' +
                '                <div><input type="text" name="" class="layui-input" id="range"></div>' +
                '            </div>' +
                '        </div>' +

                '<br>' +
                '<h4>（二）供方机构信息</h4>' +
                ' <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>总部</p>' +
                '                <div><input type="text" name="" class="layui-input" id="general"></div>' +
                '            </div>' +
                '            <div class="fr">' +
                '                <p>分支机构</p>' +
                '                <div><input type="text" name="" class="layui-input" id="branch"></div>' +
                '   </div>' +
                '</div>' +
                '<br>' +
                '<h4>（三）供方业务状况</h4>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>主营业务区域</p>' +
                '                <div><textarea placeholder="请输入内容" class="layui-textarea" id="business"></textarea></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>加工生产设备</p>' +
                '                <div> <textarea placeholder="请输入内容" class="layui-textarea" id="equipment"></textarea></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>年产能力</p>' +
                '                <div><textarea placeholder="请输入内容" class="layui-textarea" id="apc"></textarea></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>售后服务能力</p>' +
                '                <div><textarea placeholder="请输入内容" class="layui-textarea" id="after"></textarea></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>外协厂家</p>' +
                '                <div><textarea placeholder="请输入内容" class="layui-textarea" id="wxie"></textarea></div>' +
                '            </div>' +
                '</div>' +
                ' <div class="listitem">' +
                '            <div class="">' +
                '                <p>以往业绩（项目名称、开发商、合同内容、规模、状态）</p>' +
                '                <div><textarea placeholder="请输入内容" class="layui-textarea" id="ywyj"></textarea></div>' +
                '            </div>' +
                '</div>' +

                '<br>' +
                '<h4>（四）供方联系方式</h4>' +


                '        <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>联系人</p>' +
                '                <div><input type="text" name="" class="layui-input" id="linkman"></div>' +
                '            </div>' +
                '            <div class="fr center">' +
                '                <p>联系固话</p>' +
                '                <div><input type="text" name="" class="layui-input" id="phone"></div>' +
                '            </div>' +

                '        </div>' +

                '        <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>手机</p>' +
                '                <div><input type="text" name="" class="layui-input" id="tel"></div>' +
                '            </div>' +
                '            <div class="fr">' +
                '                <p>邮箱</p>' +
                '                <div><input type="text" name="" class="layui-input" id="email"></div>' +
                '            </div>' +
                '        </div>' +
                '        <div class="clearfix listitem">' +
                '            <div class="fl">' +
                '                <p>附件清单</p>' +
                '                <div><button type="button" class="layui-btn" id="upfile1"><i class="layui-icon">&#xe67c;</i>上传文件</button></div>' +
                '            </div>' +

                '        </div>' +
                '        <div class="textcenter">' +
                '            <button id="startupfile" class="layui-btn" type="button" onclick="getmsg()">保存</button>' +
                '            <button class="layui-btn canclemodel" type="button" onclick="cancleall()">取消</button>' +
                '        </div>' +
                '    </form></div>';
            layer.open({
                type: 1,
                title: ['新增供应商信息', 'font-size:16px;'],
                area: ['80%', '100%'],
                fixed: false, //不固定
                offset: 't',
                maxmin: true,
                content: addhtml,
                success: function(layero, index) {
                    // $.fn.zTree.init($("#treeDemo"), setting, zyzz);
                    // $.fn.zTree.init($("#treeDemo1"), settingtype, zNodes);

                    init();
                    layui.use(['form', 'layedit', 'laydate','upload'], function() {
                        var laydate = layui.laydate;
                        laydate.render({
                            elem: '#zyzdate'
                        });
                        var $ = layui.jquery
                            , upload = layui.upload;

                        //选完文件后不自动上传
                        upload.render({
                            elem: '#upfile1'
                            ,url: '/uploadHome'
                            ,data:{"path":"test/test1"}
                            ,auto: false
                            ,multiple: true,
                            accept: 'file'
                            ,bindAction: '#startupfile'
                            ,done: function(res){
                                alert(res.msg);
                                console.log(res)
                            }
                        });
                    })
                }
            });
        }

        function cancleall() {
            layer.closeAll()
        }
        //        查询按钮
        function searchbox() {
            let addserarchThml = '<div class="clearfix main">' +
                '<div class="fl nav">' +
                '</div>' +
                '<div class="fr">' +
                '<div class="top clearfix">' +
                '<span class="fl title" id="searchtit"> 请选择供方分类</span><i class="layui-icon-right layui-icon fl"></i>' +
                '<button type="button" class="layui-btn layui-btn" style="height: 30px;line-height:30px;position: relative;top: -1px;" id="closemask">查询</button>' +
                '</div>' +
                '<div class="clearfix type2"><span class="fl typespan">分类:</span>' +
                '<div class="fl searchfllist">' +
                '<input type="text" name="" class="layui-input" id="searchfl" readonly>' +
                '<ul id="treeDemo2" style="width:230px;" class="ztree"></ul>' +
                '</div>' +
                '</div>' +

                '<div class="clearfix " style="padding: 5px 20px;">' +
                '<span class="fl typespan">名称：</span>' +
                '<div class="fl"><input type="text" class="layui-input" id="searchname"></div>' +
                '</div>' +
                '<div class="clearfix" style="padding: 5px 20px;">' +
                '<span class="fl typespan">品牌：</span>' +
                '<div class="fl"><input type="text" class="layui-input" id="nametype"></div>' +
                '</div>' +
                '<div class="clearfix" style="padding: 5px 20px;">' +
                '<span class="fl typespan">联系人：</span>' +
                '<div class="fl"><input type="text" class="layui-input" id="searchlinkman"></div>' +
                '</div>' +
                '<div class="clearfix" style="padding: 5px 20px;">' +
                '<span class="fl typespan">电话：</span>' +
                '<div class="fl"><input type="text" class="layui-input" id="searchtel"></div>' +
                '</div>' +
                '</div>' +
                '</div>'
            layer.open({
                type: 1,
                title: ['查询', 'font-size:16px;'],
                area: ['80%', '85%'],
                fixed: false, //不固定
                maxmin: true,
                content: addserarchThml,
                success: function() {
                    $.ajax({
                        "method":"get",
                        "url":"/typeList",
                        "dataType":"json",
                        "contentType":"application/json",
                        "success":function(data){

                            if(data.code==200){
                                zNodes=data.data;
                                $.fn.zTree.init($("#treeDemo2"), searchsetting, zNodes);
                            }else{
                                layer.msg(data.msg,function(){
                                });
                            }

                        }

                    });
                }
            });
            $('#closemask').click(function() {
                search()
            });



            function getVal(controlID, controltype) {
                var objValue = '';
                switch (controltype) {
                    case 'text': //文本输入框
                        objValue = $.trim($('#' + controlID + '').val()); //取值除去所有的空格
                        break;
                    case 'radio': //单选框
                        objValue = $("input[name='" + controlID + "']:checked").val();
                        break;
                    case 'select': //下拉列表
                        objValue = $("#" + controlID + "").val();
                        break;
                    case 'checkbox': //复选框
                        $("input[name='" + controlID + "']:checked").each(function() {
                            objValue += $(this).val() + ",";
                        });
                        break;
                    default:
                        break;
                }
                return objValue;
            }
            $('#firsttype').change(function() {
                var world = getVal('firsttype', 'select');
                $('.top .title').html(world)
            });
            $('#twotype').change(function() {
                var world = getVal('twotype', 'select');
                $('#searchname').val(world)
            })
            // 更多选项展开收齐
            $('.addmore').click(function() {
                $('.moredata').slideToggle();
            });

            function search() {
                var jsonStr = "{";
                if($("#searchfl").val().trim().length!=0){
                    jsonStr=jsonStr+"\"type\":\""+$("#searchfl").val().trim()+"\",";
                }
                if($("#searchname").val().trim().length!=0){
                    jsonStr=jsonStr+"\"name\":\""+$("#searchname").val().trim()+"\",";
                }
                if($("#searchtel").val().trim().length!=0){
                    jsonStr=jsonStr+"\"tel\":\""+$("#searchtel").val().trim()+"\",";
                }
                if($("#searchlinkman").val().trim().length!=0){
                    jsonStr=jsonStr+"\"linkman\":\""+$("#searchlinkman").val().trim()+"\",";
                }
                jsonStr=jsonStr+"\"size\":20,\"pageNum\":1}";
                layui.use('laypage', function() {
                    var laypage = layui.laypage;
                    //执行一个laypage实例
                    var i = 0;
                    $.ajax({
                        url:"/customerCount",
                        contentType:"application/json",
                        dataType:"json",
                        data:jsonStr,
                        method:"post",
                        async:false,
                        success:function(data){

                            i = data.data[0];
                        }
                    });
                    laypage.render({
                        limit: 20, // 每页条数
                        elem: 'pages', //注意，这里的 test1 是 ID，不用加 # 号,
                        count:i, //数据总数，从服务端得到
                        jump: function(obj, first){
                            //obj包含了当前分页的所有参数，比如：
                            console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                            console.log(obj.limit); //得到每页显示的条数
                            var jsonData = JSON.parse(jsonStr);
                            jsonData.size = obj.limit;
                            jsonData.pageNum = obj.curr;
                            sendJsonData(JSON.stringify(jsonData),"/customerPages","post",function(data){
                                localStorage.removeItem("datalist");
                                localStorage.setItem('datalist', JSON.stringify(data.data));
                                getdatas();
                            });

                            // alert(obj.curr);
                            //首次不执行
                            if(!first){
                                //do something
                            }
                        }
                    });
                });
                layer.closeAll(); // 关闭layui的弹窗


                // var name = $('#searchname').val();
                // if (name.trim().length == 0) {
                //     getdata();
                // } else {
                //     var data = JSON.parse(localStorage.getItem('datalist'));
                //     var hasdata = [];
                //     data.map(function(item, idx) {
                //         if (item.name == name) {
                //             hasdata.push(item);
                //         }
                //     });
                //     getdata(hasdata)
                // }
            };
            // 在本地获取所有的商家信息
            function getdata(data) {
                if (!data) {
                    data = JSON.parse(localStorage.getItem('datalist'));
                }
                if (data == null || data.length == 0) {
                    $('#nodata').html('没有数据');
                    data = []
                }
                var html = '';
                data.map(function(item, idx) {
                    html += '<tr>' +
                        '<td>' + parseInt(idx + 1) + '</td>' +
                        '<td onclick="chousedata(event,' + idx + ')" style="cursor:pointer;">' + item.name + '</td>' +
                        '<td>' + item.type + '</td>' +
                        '<td>' + item.diode + '</td>' +
                        '<td>' + item.sales + '</td>' +
                        '<td>' + item.business + '</td>' +
                        '</tr>'
                });
                allhtml.html(html);
                layer.closeAll()
            }

            // 跳转到表格信息
            function suppliermsg(obj) {
                // console.log($(obj).name)
                parent.$("#nowpage").attr("src", 'pages/supplierinformation.html')
            }
            $('.nav li').click(function() {
                $(this).addClass('active').siblings().removeClass('active');
                var word = $(this).text();
                $('.title').html(word)
            });
            // 是否有资质
            $('.zizhi span,.friend span').click(function() {
                $(this).addClass('hasd').siblings().removeClass('hasd');
            });
            // 点击左侧分页
            $('.page-left').click(function() {
                var num = parseInt($('.pagenum').html());
                var numall = parseInt($('.pageAll').html());
                if (num >= 2) {
                    num--;
                }
                if (num > 1 && num < numall) {
                    $('.page-left').removeClass('page-end');
                    $('.page-right').removeClass('page-end')
                }
                if (num == 1) {
                    $('.page-left').addClass('page-end')
                }
                $('.pagenum').html(num)
            });
            // 点击右侧分页
            $('.page-right').click(function() {
                var num = parseInt($('.pagenum').html());
                var numall = parseInt($('.pageAll').html());
                if (num <= (numall - 1)) {
                    num++;
                }
                if (num > 1 && num < numall) {
                    $('.page-left').removeClass('page-end');
                    $('.page-right').removeClass('page-end')
                }
                if (num == numall) {
                    $('.page-right').addClass('page-end')
                }
                $(".pagenum").html(num)
            });
            $('.condition span').click(function() {
                let textval = $(this).text();
                $('.serchipt').val(textval);
            });
        }
        //加载新增修改客商信息时的供应商分类等
        function init(){
            $.ajax({
                "method":"get",
                "url":"/diodeList",
                "dataType":"json",
                "contentType":"application/json",
                "success":function(data){

                    if(data.code==200){
                        zyzz=data.data;
                        $.fn.zTree.init($("#treeDemo"), setting, zyzz);
                    }else{
                        layer.msg(data.msg,function(){
                        });
                    }

                }

            });
            $.ajax({
                "method":"get",
                "url":"/typeList",
                "dataType":"json",
                "contentType":"application/json",
                "success":function(data){

                    if(data.code==200){
                        zNodes=data.data;
                        $.fn.zTree.init($("#treeDemo1"), settingtype, zNodes);
                    }else{
                        layer.msg(data.msg,function(){
                        });
                    }

                }

            });
        }

        // 跳转到表格信息
        function suppliermsg(obj) {
            // console.log($(obj).name)
            parent.$("#nowpage").attr("src", 'pages/supplierinformation.html')
        }
        </script>
</body>

</html>